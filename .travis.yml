dist: trusty
sudo: true
language: java

notifications:
  email:
    recipients:
    - jeff.yemin@mongodb.com
    - ross@mongodb.com
    on_success: change
    on_failure: always

branches:
  only:
  - master

env:
  global:
    - MONGODB_FILE_NAME=mongodb-linux-x86_64-enterprise-ubuntu1404
    - MONGODB=3.6.1

addons:
  apt:
    packages:
    - libsnmp-dev

matrix:
  include:
      - arch: amd64
        jdk: oraclejdk9
        install:  
          - wget http://downloads.mongodb.com/linux/${MONGODB_FILE_NAME}-${MONGODB}.tgz
          - tar xzf ${MONGODB_FILE_NAME}-${MONGODB}.tgz
          - ${PWD}/${MONGODB_FILE_NAME}-${MONGODB}/bin/mongod --version
        before_script:
          - mkdir ${PWD}/${MONGODB_FILE_NAME}-${MONGODB}/data
          - ${PWD}/${MONGODB_FILE_NAME}-${MONGODB}/bin/mongod --dbpath ${PWD}/${MONGODB_FILE_NAME}-${MONGODB}/data --logpath ${PWD}/${MONGODB_FILE_NAME}-${MONGODB}/mongodb.log --setParameter enableTestCommands=1 --fork --smallfiles --nojournal
        
      - arch: s390x
        jdk: openjdk11
        before_script:
          - mkdir data
          - mongod --dbpath data --logpath ${PWD}/mongodb.log --setParameter enableTestCommands=1 --fork --nojournal
    
script:
  - ./gradlew -q assemble
  - ./gradlew check -Ptravistest=true
  - ./gradlew docs

after_script:
  - pkill mongod
